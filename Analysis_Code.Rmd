---
title: "Analysis_Code"
output: html_document
date: "2024-11-20"
---

To Do:

Extract data from API 
Categorize the neighborhoods by the criteria

Julia: grocery store distance
Amia: vehicles
Rosie: income

### Extract Data from API:  

HFAI  

```{r}
hfai_url <- "https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/Hfai/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json"

jsonData <- read_json(hfai_url, simplifyVector = TRUE)

hfai <- jsonData$features$attributes %>% 
  select(OBJECTID, CSA2010, hfai15, Shape__Area, Shape__Length)
head(hfai)
```


Median Income
Notes - use threshold of federal poverty level for a family of 4 ($31,200 in 2024). classify neighbourhoods as 1 where median income is 185% of this or less (in this case $57,720)

```{r}
library(jsonlite)
library(tidyverse)

income_url <- "https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/Mhhi/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson"

jsonData <- read_json(income_url, simplifyVector = TRUE)

med_income <- jsonData$features$properties %>% 
  select(OBJECTID, CSA2010, mhhi22, Shape__Area, Shape__Length)

income_criteria <- med_income %>%
  income_criteria$income_boolean <- ifelse(med_income$mhhi22 < 57720)

head(med_income)
```

Percent of Vehicles Available

```{r}
vehicles_url <- "https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/Novhcl/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json"

jsonData <- read_json(vehicles_url, simplifyVector = TRUE)

vehicles <- jsonData$features$attributes %>% 
  select(OBJECTID, CSA2010, novhcl22, Shape__Area, Shape__Length)
head(vehicles)
```

Grocery Store Location

```{r}
# install.packages("pak")
library(pak)
library(purrr)
#pak::pkg_install("elipousson/mapbaltimore", dependencies = TRUE)
library(mapbaltimore)
grocery_store_url <- "https://services1.arcgis.com/UWYHeuuJISiGmgXx/arcgis/rest/services/Grocery_Store/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json"

jsonData <- read_json(grocery_store_url, simplifyVector = TRUE)

grocery_stores <- jsonData$features$attributes

# remove store in row 46 because it is outside of the zone and doesn't register as an address

add <- grocery_stores$address[1:45]

csas_with_store <- map(.x = add, .f = ~ get_area(type="csa", location = .x)$name)

# assign manually stores which did not get assigned a CSA

csas_with_store[[19]] <- "South Baltimore"
csas_with_store[[38]] <- "South Baltimore" 

# create vector with CSA names

csas <- vehicles$CSA2010

contains_store <- function(n) {
  if(n %in% csas_with_store) {
    1
  } else {
    0
  }
}

grocery_stores_csa <- data.frame(cbind(csas, map_dbl(.x = csas, .f = ~contains_store(.x))))
colnames(grocery_stores_csa) <- c("CSA2010", "groc_store")
head(grocery_stores_csa)

#data.frame(cbind(mapbaltimore::csas$name, vehicles$CSA2010))
#vehicles$CSA2010 %in% mapbaltimore::csas$name
#length(mapbaltimore::csas$name)
#length(vehicles$CSA2010)
#mapbaltimore::csas$name %in% vehicles$CSA2010
#mapbaltimore::csas$name[51]
```




